# ğŸ“¸ Barbie List Instagram Enhancement

## **Overview**

This enhancement adds Instagram support to the Barbie List contact management system, allowing users to store Instagram handles, view profiles, and get AI-powered opener suggestions based on profile analysis.

## **Features**

### **1. Instagram Field Storage**
- **Database Fields**: `instagram_handle`, `instagram_url`, `instagram_last_checked`, `ai_ig_summary`, `ai_ig_openers`, `is_private`
- **Normalization**: Handles various input formats (@username, instagram.com/username, full URLs)
- **Validation**: Ensures valid Instagram handle format (1-30 chars, alphanumeric + dots/underscores)

### **2. Enhanced Add Contact Modal**
```
ğŸ“ Add New Contact Modal:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Name: Sarah                         â”‚
â”‚ Where did you meet?: Coffee Shop    â”‚
â”‚ Phone Number: (555) 123-4567        â”‚
â”‚ Instagram (handle or URL): @sarah_d â”‚
â”‚ Vibe Rating (1-10): 8               â”‚
â”‚ Notes (what you talked about, etc.):â”‚
â”‚ "Met at Starbucks, she's a graphic  â”‚
â”‚ designer who loves hiking..."       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **3. Privacy Guard System**
- **Private Contacts**: Instagram info hidden in public channels
- **Public Channels**: Shows "ğŸ”’ Private â€” IG hidden in public channel"
- **Private Channels/DMs**: Full Instagram info visible
- **Privacy Control**: `is_private` flag controls visibility

### **4. Instagram Analysis (Stub)**
- **Local Analysis**: No external data access
- **Deterministic Results**: Based on handle as seed
- **Rate Limited**: 1 analysis per 60 seconds per user
- **AI Summary**: Generated profile insights
- **Opener Suggestions**: 2 personalized conversation starters

## **Database Schema**

```sql
-- Migration 017_barbie_instagram.sql
ALTER TABLE barbie_list
  ADD COLUMN IF NOT EXISTS instagram_handle TEXT,
  ADD COLUMN IF NOT EXISTS instagram_url TEXT,
  ADD COLUMN IF NOT EXISTS instagram_last_checked TIMESTAMPTZ,
  ADD COLUMN IF NOT EXISTS ai_ig_summary TEXT,
  ADD COLUMN IF NOT EXISTS ai_ig_openers TEXT[] DEFAULT '{}',
  ADD COLUMN IF NOT EXISTS is_private BOOLEAN DEFAULT false;

-- Indexes for performance
CREATE INDEX IF NOT EXISTS idx_barbie_instagram_handle ON barbie_list (LOWER(instagram_handle));
CREATE INDEX IF NOT EXISTS idx_barbie_list_privacy ON barbie_list (user_id, is_private);
```

## **API Reference**

### **Instagram Normalization Utility**
```javascript
const { normalizeInstagram } = require('../../utils/social');

// Accepts various formats
const result = normalizeInstagram('@sarah_designer');     // { handle: 'sarah_designer', url: 'https://www.instagram.com/sarah_designer' }
const result = normalizeInstagram('instagram.com/sarah'); // { handle: 'sarah', url: 'https://www.instagram.com/sarah' }
const result = normalizeInstagram('invalid');            // null
```

### **BarbieListManager Methods**
```javascript
// Add contact with Instagram
const result = await manager.addContact(userId, {
  name: 'Sarah',
  instagramHandle: 'sarah_designer',
  instagramUrl: 'https://www.instagram.com/sarah_designer',
  isPrivate: false
});

// Update Instagram analysis
await manager.updateInstagramAnalysis(contactId, userId, {
  summary: 'Creative designer with hiking interests...',
  openers: ['Hey! Saw some creative vibes...', 'What\'s your go-to weekend adventure?']
});

// Get contacts with Instagram
const contacts = await manager.getContactsWithInstagram(userId, 50);
```

### **Instagram Analyzer Stub**
```javascript
const instagramAnalyzer = require('../../services/ai/InstagramAnalyzerStub');

const analysis = await instagramAnalyzer.analyze({
  handle: 'sarah_designer',
  url: 'https://www.instagram.com/sarah_designer'
});

// Returns:
// {
//   summary: 'Stub analysis for @sarah_designer: Based on handle patterns...',
//   openers: ['Hey! Saw some creative vibes...', 'If you had a day with zero plans...'],
//   disclaimer: 'Generated by local stub (no external data accessed)',
//   lastAnalyzed: '2024-01-15T10:30:00.000Z'
// }
```

## **User Experience Flow**

### **1. Adding Contact with Instagram**
1. User runs `/barbie add`
2. Modal opens with Instagram field
3. User enters `@sarah_designer` or `instagram.com/sarah`
4. System normalizes and validates input
5. Contact saved with Instagram data
6. Confirmation shows Instagram handle and XP earned

### **2. Viewing Contact with Instagram**
1. User runs `/barbie view <id>`
2. Contact embed shows Instagram handle
3. Two buttons appear:
   - **"View Instagram"** (link button to profile)
   - **"Analyze IG (beta)"** (triggers analysis)

### **3. Instagram Analysis**
1. User clicks "Analyze IG (beta)"
2. Rate limit check (1 per 60 seconds)
3. Local stub analysis generates summary and openers
4. Results displayed in embed with disclaimer
5. Analysis stored in database for future reference

## **Privacy & Security**

### **Privacy Controls**
- **Public Channels**: Private contacts hide Instagram info
- **Private Channels**: All Instagram info visible
- **DM Interactions**: Always show full Instagram info
- **Rate Limiting**: Prevents abuse of analysis feature

### **Data Safety**
- **No External Calls**: All analysis is local stub
- **No Scraping**: No Instagram data fetched
- **Deterministic**: Same handle always produces same analysis
- **Cache Management**: In-memory cache with size limits

## **Rate Limiting**

```javascript
// Instagram analysis rate limiting
const rateLimitKey = `ig-analyze:${userId}`;
const isRateLimited = await services.rateLimiter.isRateLimited(rateLimitKey, 1, 60000);
// 1 analysis per 60 seconds per user
```

## **Error Handling**

### **Common Errors**
- **Invalid Instagram Format**: "Invalid Instagram format. Please use @username or instagram.com/username"
- **Rate Limited**: "â±ï¸ Rate limited: Please wait 60 seconds before analyzing another Instagram profile."
- **No Instagram Set**: "No Instagram handle set for this contact."
- **Contact Not Found**: "Contact not found."

### **Fallback Behavior**
- Invalid Instagram input prevents contact creation
- Missing Instagram handle disables analysis button
- Rate limiting shows friendly message with wait time
- Analysis failures show generic error message

## **Migration Instructions**

1. **Run Migration**:
   ```bash
   npm run migrate
   ```

2. **Verify Schema**:
   ```sql
   \d barbie_list
   ```

3. **Test Instagram Fields**:
   ```sql
   SELECT instagram_handle, instagram_url, is_private FROM barbie_list LIMIT 5;
   ```

## **Future Enhancements**

### **Phase 2 Possibilities**
- **Real Instagram API**: Integrate with Instagram Basic Display API
- **Profile Scraping**: Legal profile data extraction
- **Advanced Analysis**: ML-based personality insights
- **Photo Analysis**: Computer vision for content analysis
- **Engagement Tracking**: Monitor interaction patterns

### **UI Improvements**
- **Instagram Preview**: Thumbnail images in contact cards
- **Story Highlights**: Recent story analysis
- **Bio Analysis**: Extract interests and personality traits
- **Hashtag Trends**: Popular hashtags for conversation starters

## **Testing Checklist**

- [ ] Migration runs without errors
- [ ] Instagram normalization handles all input formats
- [ ] Contact creation with Instagram works
- [ ] Privacy guard hides Instagram in public channels
- [ ] Instagram analysis generates consistent results
- [ ] Rate limiting prevents abuse
- [ ] Error messages are user-friendly
- [ ] Database indexes improve query performance

## **Performance Considerations**

- **Indexes**: Instagram handle lookups are indexed
- **Caching**: Analysis results cached in memory
- **Rate Limiting**: Prevents excessive analysis requests
- **Privacy Filtering**: Efficient privacy checks
- **Batch Operations**: Bulk Instagram updates supported

---

**âš ï¸ Important**: This is a stub implementation that generates placeholder analysis without accessing external Instagram data. All analysis is deterministic and local-only for privacy and compliance.
