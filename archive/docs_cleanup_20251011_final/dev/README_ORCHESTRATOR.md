# üõ†Ô∏è MEGA FIX ORCHESTRATOR

**Purpose:** Automatically generate targeted, copy-paste-ready fix prompts for every feature in the codebase.

---

## What It Does

The orchestrator reads `reports/MEGA_DISCOVERY_REPORT.json` (generated by `mega_discovery.mjs`) and:

1. **Analyzes each feature** using evidence-based heuristics
2. **Generates targeted tasks** based on what's missing or incomplete
3. **Creates per-feature fix prompts** with exact file paths and steps
4. **Produces a master report** with executive summary and actionable index

---

## Generated Artifacts

### üìÑ reports/MEGA_TEST_REPORT.v2.md
- **Executive summary** with feature counts and metrics
- **Feature table** showing status, confidence, and component counts
- **Actionable fixes index** with links to individual prompts
- **Migration gaps**, **ENV delta**, and **hotspots**

### üìÇ reports/fix_prompts/*.md
- **65 individual fix prompts** (one per feature)
- Each includes:
  - Status and confidence score
  - Primary flow mapping
  - Evidence summary (commands, services, tables, jobs, events)
  - **Targeted tasks** with exact steps
  - Counts summary

---

## Usage

### 1. Run Discovery (get fresh data)
```bash
node scripts/dev/mega_discovery.mjs --log=true
```

### 2. Generate Fix Prompts
```bash
node scripts/dev/mega_fix_orchestrator.mjs
```

### 3. Review Master Report
```bash
cat reports/MEGA_TEST_REPORT.v2.md
```

### 4. Pick a Feature to Fix
```bash
# Browse all prompts
ls reports/fix_prompts/

# Read a specific prompt
cat reports/fix_prompts/discord.md
```

### 5. Apply the Fix
Copy the targeted tasks from the prompt and implement them.

### 6. Verify Progress
```bash
# Re-run discovery to see status changes
node scripts/dev/mega_discovery.mjs --log=true
node scripts/dev/mega_fix_orchestrator.mjs

# Watch features move from WARN ‚Üí PASS
```

---

## Fix Prompt Structure

Each `reports/fix_prompts/<feature>.md` contains:

```markdown
# üß© FIX PROMPT ‚Äî <feature>

**Status:** WARN ‚Ä¢ **Confidence:** 0.5

**Primary Flow:** User ‚Üí /<feature> ‚Üí service(s) ‚Üí tables

**Evidence**
- Commands: file1.js, file2.js
- Services: ServiceA.js, ServiceB.js
- Tables: table_a, table_b
- Events: event1, event2
- Jobs: job1.js
- Candidates: file.candidate.js
- Markers: 3 (TODO: 1, STUB: 2)

---

## üéØ Targeted Tasks

### Task Title
- Step 1 with exact file path
- Step 2 with exact implementation detail
- Step 3 with wiring/registration requirements

---

## üìù Counts Summary
(Numeric summary of all components)
```

---

## Feature Status Meanings

- **PASS** (12 features): Complete features with command + service + no critical issues
  - Ready for production
  - No immediate action needed
  
- **WARN** (20 features): Partial implementations or backend-only services
  - Usually missing user-facing commands
  - Or have minor TODOs/improvements
  
- **FAIL** (24 features): Missing core pieces or utilities/config files
  - Config files (expected to have no commands)
  - Utilities (expected to be support code)
  - Repositories (data layer, no UI needed)
  
- **SKIP** (9 features): Event handlers, jobs, or low-confidence inference
  - Infrastructure components
  - Not actionable as "features"

---

## Heuristics Used

The orchestrator applies these rules to generate targeted tasks:

### 1. Candidate Promotion
- **If:** Feature has `.candidate.js` files
- **Task:** "Promote candidate files" with exact paths

### 2. Command/Service Parity
- **If:** Has services but no commands
- **Task:** "Create user-facing command shell" with registration steps

### 3. Database Bridging
- **If:** Has tables but no service layer
- **Task:** "Add service layer for DB access" with CRUD implementation guide

### 4. Stub Replacement
- **If:** Markers include "STUB" or "DO NOT SHIP"
- **Task:** "Replace stub(s)" with file-specific prompts

### 5. TODO Clearing
- **If:** Markers include "TODO"
- **Task:** "Resolve TODOs" with specific references

### 6. ENV Validation
- **If:** Code references ENV keys
- **Task:** "ENV validation" with exact keys to add

### 7. Admin Runner for Jobs
- **If:** Has scheduled jobs but no commands
- **Task:** "Expose admin runner" to dry-run jobs without waiting for cron

---

## Example Workflow

```bash
# Start with fresh discovery
$ node scripts/dev/mega_discovery.mjs --log=true
# Output: 12 PASS, 20 WARN, 24 FAIL, 9 SKIP

# Generate fix prompts
$ node scripts/dev/mega_fix_orchestrator.mjs
# Output: 65 fix prompts generated

# Review master report
$ cat reports/MEGA_TEST_REPORT.v2.md
# See: "discord" is WARN with 5 services, 0 commands

# Read specific prompt
$ cat reports/fix_prompts/discord.md
# See: "Create user-facing command shell" task

# Implement the fix (manually or via AI)
# ... create src/commands/discord/discord.js
# ... register in src/commands/index.js
# ... add rate limit

# Verify progress
$ node scripts/dev/mega_discovery.mjs --log=true
# Output: 13 PASS, 19 WARN (discord moved to PASS!)
```

---

## Integration with Development Workflow

### Use Case 1: Sprint Planning
- Run orchestrator at sprint start
- Pick top 3-5 WARN features
- Assign fix prompts to team members
- Track WARN ‚Üí PASS migrations

### Use Case 2: Onboarding New Developers
- Give new dev the master report
- They can see all features at a glance
- Pick a WARN feature to get familiar with codebase
- Fix prompts provide exact guidance

### Use Case 3: Technical Debt Reduction
- Identify all features with TODOs/STUBs
- Prioritize by confidence score
- Systematically clear markers
- Re-run to track progress

### Use Case 4: Pre-Release Audit
- Run discovery + orchestrator
- Ensure no STUB markers in production features
- Validate all ENV keys are set
- Check migration gaps are filled

---

## Files Changed

**New files created:**
- `scripts/dev/mega_fix_orchestrator.mjs` (this orchestrator)
- `reports/MEGA_TEST_REPORT.v2.md` (master report)
- `reports/fix_prompts/*.md` (65 feature-specific prompts)

**No runtime code modified** ‚Äî orchestrator is read-only analysis tool.

---

## Safety Guarantees

‚úÖ **Read-only** ‚Äî No app code changes  
‚úÖ **No commits** ‚Äî Only creates reports  
‚úÖ **No network** ‚Äî Pure local analysis  
‚úÖ **No side effects** ‚Äî Safe to run anytime  
‚úÖ **Deterministic** ‚Äî Same input ‚Üí same output  

---

## Maintenance

### When to re-run:
- After implementing any fix prompt
- After adding new features
- Before major releases
- Weekly during active development

### When to update orchestrator logic:
- If new heuristics are discovered
- If feature patterns change
- If new evidence types are added to discovery

---

## Next Steps

1. **Review:** `reports/MEGA_TEST_REPORT.v2.md`
2. **Pick:** A WARN feature from `reports/fix_prompts/`
3. **Implement:** The targeted tasks in the prompt
4. **Verify:** Re-run discovery to see status change
5. **Repeat:** Until all WARN features are PASS

---

**Questions?** The orchestrator is self-documenting ‚Äî read the source code at `scripts/dev/mega_fix_orchestrator.mjs`.


